"""add_soft_delete_to_models

Revision ID: 299176cb847e
Revises: a9b3daf5cb28
Create Date: 2025-07-06 04:47:24.158354

"""

from typing import Sequence, Union

import sqlalchemy as sa

from alembic import op

# revision identifiers, used by Alembic.
revision: str = "299176cb847e"
down_revision: Union[str, Sequence[str], None] = "a9b3daf5cb28"
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    """Upgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.add_column(
        "orders",
        sa.Column(
            "is_deleted", sa.Boolean(), nullable=False, server_default=sa.false()
        ),
    )
    op.add_column("orders", sa.Column("deleted_at", sa.DateTime(), nullable=True))
    op.create_index(
        op.f("ix_orders_deleted_at"), "orders", ["deleted_at"], unique=False
    )
    op.create_index(
        op.f("ix_orders_is_deleted"), "orders", ["is_deleted"], unique=False
    )

    op.add_column(
        "strategies",
        sa.Column(
            "is_deleted", sa.Boolean(), nullable=False, server_default=sa.false()
        ),
    )
    op.add_column("strategies", sa.Column("deleted_at", sa.DateTime(), nullable=True))
    op.create_index(
        op.f("ix_strategies_deleted_at"), "strategies", ["deleted_at"], unique=False
    )
    op.create_index(
        op.f("ix_strategies_is_deleted"), "strategies", ["is_deleted"], unique=False
    )

    op.add_column(
        "trades",
        sa.Column(
            "is_deleted", sa.Boolean(), nullable=False, server_default=sa.false()
        ),
    )
    op.add_column("trades", sa.Column("deleted_at", sa.DateTime(), nullable=True))
    op.create_index(
        op.f("ix_trades_deleted_at"), "trades", ["deleted_at"], unique=False
    )
    op.create_index(
        op.f("ix_trades_is_deleted"), "trades", ["is_deleted"], unique=False
    )

    op.add_column(
        "users",
        sa.Column(
            "is_deleted", sa.Boolean(), nullable=False, server_default=sa.false()
        ),
    )
    op.add_column("users", sa.Column("deleted_at", sa.DateTime(), nullable=True))
    op.create_index(op.f("ix_users_deleted_at"), "users", ["deleted_at"], unique=False)
    op.create_index(op.f("ix_users_is_deleted"), "users", ["is_deleted"], unique=False)

    # Add soft delete columns to user_behavior_logs
    op.add_column(
        "user_behavior_logs",
        sa.Column(
            "is_deleted", sa.Boolean(), nullable=False, server_default=sa.false()
        ),
    )
    op.add_column(
        "user_behavior_logs", sa.Column("deleted_at", sa.DateTime(), nullable=True)
    )
    op.create_index(
        op.f("ix_user_behavior_logs_deleted_at"),
        "user_behavior_logs",
        ["deleted_at"],
        unique=False,
    )
    op.create_index(
        op.f("ix_user_behavior_logs_is_deleted"),
        "user_behavior_logs",
        ["is_deleted"],
        unique=False,
    )

    # Add soft delete columns to trade_analytics
    op.add_column(
        "trade_analytics",
        sa.Column(
            "is_deleted", sa.Boolean(), nullable=False, server_default=sa.false()
        ),
    )
    op.add_column(
        "trade_analytics", sa.Column("deleted_at", sa.DateTime(), nullable=True)
    )
    op.create_index(
        op.f("ix_trade_analytics_deleted_at"),
        "trade_analytics",
        ["deleted_at"],
        unique=False,
    )
    op.create_index(
        op.f("ix_trade_analytics_is_deleted"),
        "trade_analytics",
        ["is_deleted"],
        unique=False,
    )

    # Add soft delete columns to backtest_results
    op.add_column(
        "backtest_results",
        sa.Column(
            "is_deleted", sa.Boolean(), nullable=False, server_default=sa.false()
        ),
    )
    op.add_column(
        "backtest_results", sa.Column("deleted_at", sa.DateTime(), nullable=True)
    )
    op.create_index(
        op.f("ix_backtest_results_deleted_at"),
        "backtest_results",
        ["deleted_at"],
        unique=False,
    )
    op.create_index(
        op.f("ix_backtest_results_is_deleted"),
        "backtest_results",
        ["is_deleted"],
        unique=False,
    )

    # Add soft delete columns to signals
    op.add_column(
        "signals",
        sa.Column(
            "is_deleted", sa.Boolean(), nullable=False, server_default=sa.false()
        ),
    )
    op.add_column("signals", sa.Column("deleted_at", sa.DateTime(), nullable=True))
    op.create_index(
        op.f("ix_signals_deleted_at"), "signals", ["deleted_at"], unique=False
    )
    op.create_index(
        op.f("ix_signals_is_deleted"), "signals", ["is_deleted"], unique=False
    )
    # ### end Alembic commands ###


def downgrade() -> None:
    """Downgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index(op.f("ix_signals_is_deleted"), table_name="signals")
    op.drop_index(op.f("ix_signals_deleted_at"), table_name="signals")
    op.drop_column("signals", "deleted_at")
    op.drop_column("signals", "is_deleted")

    op.drop_index(op.f("ix_backtest_results_is_deleted"), table_name="backtest_results")
    op.drop_index(op.f("ix_backtest_results_deleted_at"), table_name="backtest_results")
    op.drop_column("backtest_results", "deleted_at")
    op.drop_column("backtest_results", "is_deleted")

    op.drop_index(op.f("ix_trade_analytics_is_deleted"), table_name="trade_analytics")
    op.drop_index(op.f("ix_trade_analytics_deleted_at"), table_name="trade_analytics")
    op.drop_column("trade_analytics", "deleted_at")
    op.drop_column("trade_analytics", "is_deleted")

    op.drop_index(
        op.f("ix_user_behavior_logs_is_deleted"), table_name="user_behavior_logs"
    )
    op.drop_index(
        op.f("ix_user_behavior_logs_deleted_at"), table_name="user_behavior_logs"
    )
    op.drop_column("user_behavior_logs", "deleted_at")
    op.drop_column("user_behavior_logs", "is_deleted")

    op.drop_index(op.f("ix_users_is_deleted"), table_name="users")
    op.drop_index(op.f("ix_users_deleted_at"), table_name="users")
    op.drop_column("users", "deleted_at")
    op.drop_column("users", "is_deleted")

    op.drop_index(op.f("ix_trades_is_deleted"), table_name="trades")
    op.drop_index(op.f("ix_trades_deleted_at"), table_name="trades")
    op.drop_column("trades", "deleted_at")
    op.drop_column("trades", "is_deleted")

    op.drop_index(op.f("ix_strategies_is_deleted"), table_name="strategies")
    op.drop_index(op.f("ix_strategies_deleted_at"), table_name="strategies")
    op.drop_column("strategies", "deleted_at")
    op.drop_column("strategies", "is_deleted")

    op.drop_index(op.f("ix_orders_is_deleted"), table_name="orders")
    op.drop_index(op.f("ix_orders_deleted_at"), table_name="orders")
    op.drop_column("orders", "deleted_at")
    op.drop_column("orders", "is_deleted")
    # ### end Alembic commands ###
